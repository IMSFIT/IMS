%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[12pt,a4paper,titlepage,final]{article}
\newcommand{\uv}[1]{\quotedblbase #1\textquotedblleft}
% cestina a fonty
\usepackage[czech]{babel}
\usepackage[utf8]{inputenc}
% balicky pro odkazy
\usepackage[bookmarksopen,colorlinks,plainpages=false,urlcolor=blue,unicode]{hyperref}
\usepackage{url}
% obrazky
\usepackage[dvipdf]{graphicx}
\usepackage{listings} 
% velikost stranky
\usepackage{graphicx}
\usepackage[top=3.5cm, left=2.5cm, text={17cm, 24cm}, ignorefoot]{geometry}

\begin{document}

\input{title.tex}

\tableofcontents
\newpage

\section{Úvod}
Táto dokumentácia sa zaoberá vývojom, implementáciou a testovaním systéum hromadnej obsluhy "Štátna volebná infraštruktúra", ktorá simuluje volebný systém v Českej republike zahrňujúci voľby v okrskov a krajských mestskách a následne odoslanie a počítanie hlasov v informačnom centre.
\indent
Na základe modelu a simulácie bude ukázané chovanie systému so zreteľom na ukázanie slabých miest pri voľbách. Tento projekt môže byť použitý na optimalizáciu systému voliev v Českej republike vzhľadom na zrychlénie celého systému počítania hlasov a rozdelenie do okrskov.

\subsection{Autori}
Na projekte SHO "Štátna volebná infraštruktúra" sa podieľali nasledujúci autori:
\begin{itemize}
\item Martin Maga(xmagam00)
\item Vojtěch Meca(xmecav00)
\end{itemize}

Okrem vyššie spomenutých ľudí sme využili možňosť konzultácie s pánom doktorom Hrubým(konzultácia ohľadne správnosti nášho návrhu Petriho siete).

\subsection{Testovacie prostredie}
Pre testovacie účely boli použité architekrúry:Linux 3.2.0-56-generic $86_64$ GNU/Linux pre menšie vzorky dát a pre rozsiahlejšie testovanie na väčšej vzorke dát: FreeBSD eva.fit.vutbr.cz 9.2-STABLE FreeBSD amd64.

\subsection{Validita}
Experimentovaním sme overovali validitu modelu, ktoré vo forme histogramu a jeho následnej analýze odpovedali nášhu odhadovanému predpokladu. Tak isto sme využili dostupné informácie o spôsoboe volieb v Českej republiky a štatistických informáciách, ktoré sú verejne prístupné na internete.

\subsection{Zadanie}
Obsah zadania: "Státní volební infrastruktura nechť se skládá z volebního informačního centra a sítě volebních okrsků. Centrum přijímá zprávy od volebních okrsků a prezentuje výsledky v jednotlivých krajích (nutno modelovat server centra jako obslužnou linku). Volební okrsky jsou SHO obsahující obslužné linky: komise a místo pro provedení volby do obálky ("za plentou"). Modelujte proces příchodů voličů v průběhu doby voleb. Volební komise skončí práci buď po odvolení všech občanů v okrsku nebo okamžikem konce volebního víkendu. Potom sčítá hlasy (doba je závislá na počtu obálek v urně) a odesílá výsledky do centra. Prostudujte systém voleb v ČR a síť volebních okrsků. Konkrétní síť okrsků generujte náhodně s následujícím omezením: sumární počet voličů v krajích musí odpovídat realitě a počet voličů v krajských městech musí odpovídat realitě. Okrsky nějak vhodně agregujte tak, aby jejich celkový počet byl cca 200. Náhodně generovanou síť okrsků uložte do souboru a experimenty provádějte stále nad stejným modelem sítě okrsků. Zdokumentujte model sítě okrsků. Na experimentech ukažte propustnost centra, doby čekání okrsků na připojení do centra, celkovou dobu práce lidí okrskových komisích."
Obsah je dostupný online z nasledujúceho odkazu: http://perchta.fit.vutbr.cz:8000/vyuka-ims/31.\cite{Prokop:Algoritmy}



\subsection{Ciele projektu}
Ciele projektu zahŕňajú:
\begin{itemize}
\item Analýza aktuálneho volebného systému v Českej republike
\item Analýza slabých miest volebného systému
\item Návrh efektívnejšieho prístupu, ktoré by dokázalo zvýšiť rýchlosť počítania hlasov
\end{itemize}


\section{Rozber témy a použitých technológií}

\indent


Pre zobrazenie výsledkov bola použitá trieda Histogram, ktorá je štandardnou súčasťou knižnice Simlib.


\subsection{Popis použitých postupov}
Pre implementáciu bol zvolený jazyk C++ a knižnicu určenú na simuláciu Simlib. Toto rozhodnutie bolo učinené na základe formálnych požiadavok na tvorbu projektu. Ďalším kritériom bola aj široká ponuka prostriedkov, ktoré knižnica Simlib ponúka na simuláciu modelov. Ďalej treba spomenúť, že kód v C++ je pomerne rýchly.



\subsection{Pôvod použitých technológií}
\begin{itemize}
\item Simlib -http://www.fit.vutbr.cz/~peringer/SIMLIB/ (GNU LGPL)
\item C++ - http://en.wikipedia.org/wiki/C++
\item Ubuntu - http://www.ubuntu.com/
\item Petriho siete - $http://en.wikipedia.org/wiki/Petri_net$
\item GNU PLOT - $http://www.gnuplot.info/$

\end{itemize}
\subsection{Volebný systém v Českej republike}
Česká republika sa zaraďuje medzi dvojkomorové parlamentné 
systémy. Tvorí ju Poslanecká snemovňa a Senát. Do PS ČR sa volí na 
základe pomerného voličského systému. Základnú reguláciu nájdeme 
v Ústave ČR. V čl. 18 nachádzame základné princípy volieb, ako je spôsob 
voľby tajným hlasovaním na základe všeobecného, rovného a priameho 
práva, podľa zásad pomerného zastúpenia. Ďalším dôleţitým zákonom je 
zákon č. 247/1995 Sb., o voľbách. Niektoré ustanovenia sú prevedené 
vyhláškou č. 233/2000 Sb. Tieto právne pramene sú základnými právnymi 
prameňmi v oblasti volieb v ČR.\cite{Seda:Voleb}

Voľby prebiehajú štandardne každé 4 roky, alebo po po predčasných voľbách. Každému občanovi republiky prislúcha 1 volebný hlas, ktorý musí odovzdať. Každý občas patrí pod istý volebný kraj, ktorý sa delí na menšiu časti zvané okrsky. Voľby prebiehajú štandardne v sobotu alebo v nedeľu dokopy 14 hodín. Každý občan, ktorý spĺňa podmienky príde v mieste svojho bydliska do volebnej miestnosti, kde sa preukáže platnosti dokladom totožnosti volebnej komisii, ktorá skontroluje údaje a povolí občanovi voliť. Každý občan ide jednotlivo za urnu, kde zaškrtne možnosť a následne vhodí svoj hlas do urny a zvyšné zahadzuje.

Na konci volieb sú hlasí v jednotlivých okrskoch sčítané a odnesené na obecný úrad, odkiaľ sa posielalu na prepočítanie do lebného centra.

  







\section{Koncepce - modelářska témata}
Na obrázku č. 1 je uvedeno schéma systému Volební infrastruktury.\newpage 
\begin{figure}[h]

\begin{center}

\includegraphics[scale=0.7]{img/konceptualni_model.eps} 
\caption{Konceptuálny model}
\label{koncept}

\end{center}

\end{figure}
\newpage

\subsection{Opis konceptuálneho modelu}
 V obrázku č. 1 můžeme vidět několik různých obdelníčků a zaoblených obdelníčků. Popišeme si je jednotlivě:	
 \begin{itemize}
\item 	a) Zaoblený obdelníček s názvem Generátor okrsků
\subitem	 Tento zaoblený obdelníček má za úkol generovat obdelníčky Okrsky. Generuje jich přesně kolik jich má vzniknout (určeno například souborem). Po vygenerovaní Okrsků generátor ukončí svou činnost.
\item 	b) Normální obdelníček s názvem Okrsek č. 1...n
\subitem	 Při vytvoření tohoto objektu  se nainicialzují hodnoty, které jsou získány z Generátoru okrsků a dále vytvoří si Generátor voličů a taktéž si vytvoří Proces konce chození voličů. Poté objekt slouží pouze pro ukládání hodnot, které se můžou během programu měnit.
\item 	c) Zaoblený obdelníček s názvem Generátor voličů
\subitem	 Po vytvoření Okrsekem začne generovat voliče, kteří jdou volit. Vytvoří jich podle parametru maximálního počtu voličů a dále taky podle parametru volební účast voličů. Po vygenerovaní všech voličů, zahlásí konec voleb, a tímto její činnost skončí. 
\item 	d) Zaoblený obdelníček s názvem Proces voliče č. 1 .. n
\subitem	 Je vytvořen Generátorem voličů. Po vytvoření simuluje všechny zásadní pokyny po správné odvolení voliče. Po samotném odvolení voliče proces končí.
 \item	e) Zaoblený obdelníček s názvem Proces konce chození voličů
\subitem	 Je vytvořen Okrskem. Zapne v sobě časovač reprezentující dobu voleb. Po uplynutí časovače nebo po příchodu všech voličů v okrsku se vyvolá Proces počítání hlasů. Poté jeho činnost končí.
\item 	f) Zaoblený obdelníček s názvem Proces počítání hlasů
\subitem	 Vytváří Genreátor volibních lístků. Správně spočítáné výsledky posílá do Volebního centra. Poté jeho činnost končí.
\item 	g) Zaoblený obdelníček s názvem Proces generátor volebních lístků
\subitem	 Po vytvoření Procesem počítání hlasů začne generovat Procesy počítání listků č.1 .. n. Po vygerenerování všech lístků zkončí svou činnost.
\item 	h) Zaoblený obdelníček s názvem Proces počítání listků č.1 .. n
\subitem	 Po vytvoření simuluje práci jednoho člena volební komise s tímto lístkem. Po ukončení počítání tohoto lístku jedním členem komise činnost tohoto obdelníčku končí.
\end{itemize}
\newpage 
\begin{figure}[h]

\begin{center}

\includegraphics[scale=0.4]{img/petri2.eps} 
\caption{Konceptuálny model}
\label{koncept}

\end{center}

\end{figure}

Obrázok popisuje Petriho sieť, ktorá ukazujem systém volieb. Ukazuje príchod voliča, odvolenie voliča. Na začiatku sa vygenerujú voliči, ktorí prijdu do volebnej miestnosti. Pri vstupe do miestnosti si občan zabere člena volebnej komisie, ktorý je reprezentovaný štruktúrou "Store" s kapacitou 12 v Simlibe. Pokiaľ nie je voľný nejaký člen volebnej komisie, tak se zařadí do společné fronty a čeká na uvolnění některého ze členů volební komise. Pokiaľ sa občan dostane na radu, tak ho člen volebnej komisie skontroluje. To trvá exponeniciálně 30 sekúnd. Po skončení kontroly občana členem volební komise, občan pokračuje ďalej. Zabere si "Store" s kapacitou 3, ktorý reprezentuje volebnú plentu. V prípade, že nie je volná plenta, tak sa občan zaradí do jedné společné fronty. Následne užívateľ zajde za plentu a zaškrtá výsledok. To trvá exponenciálně 15 sekúnd. Následne si zabere plentu, ktorá je len 1. Pokiaľ nie je voľná tak sa zaradí do fronty a čaká. Po vhození lístku reprezentující dobu exponenciálně 2 sekundy občan opúšťa systém.
\newpage


\subsection{Forma konceptuálneho modelu}


\subsection{Implementácia}
Program pracuje na základním procesu, který regeneruje v čase nula objekty reprezentující okrsky České republiky. Při vytvoření objektu jednotlivého okrsku se nainicializují data. Objekt reprezentující okresek po inicializaci spustí po sobě jdoucí 2 procesy. První z nich je proces, který po svém vzniku začne generovat procesy příchodů voličů do volební místnosti. Druhý z procesů vytvoří časovač, který udává legální délku voleb. Po uplynutí určeného času na příchod voličů tento proces vytvoří nový proces. Nově vytvořený proces se stará o počítání jednotlivých volebních lístků ve volební místnosti, dále simuluje kontrolu výsledků a taky posílání správně vypočtených výsledků do Volebního centra České Republiky. Problém počítání jednotlivých volebních lístků řeší pomocí procesu na generování procesu počítání volebního lístku. V případě, že po spočítání výsledků se zjistí, že nastala chyba v počtech, proces zopakuje počítání volebních lístků znovu. 




\section{Architektura simulačního modelu}

\subsection{Popis architektury}
V programu je několik tříd, které zajišťují jeho spávný průběh. 
 \begin{itemize}
\item Třída GenOkrsku
\subitem Tato třída reprezentuje proces Generování okrsku z konceptuálního modelu na Obr. č. 1. Tato třída se dědí od třídy Event z knihovny SIMlib obsahuje pouze jednu metodu Behavior(). Metoda Behavior() ze začátku načítá první řádek ze souboru. V souboru na prvním řádku je informace o celkovém počtu okrsků. Dále pokračuje jedním cyklem, který při každém průchodu načítá data jednoho řádku ze souboru, což reprezentuje data určené právě pro jeden okrsek. Poté cyklus pokračuje vytvořením nového oběktu třídy Okrsek a posílá získané data ze souboru do jako parametry konstruktoru. Po vytvoření všech Oksrku, svou činnost končí.

\item Třída Okrsek
\subitem Tato třída reprezentuje objěkt Okrsek z konceptuálního modelu na Obr. č. 1. Tato třída má konstruktor a mnoho dalších metod na získávání, nastavování atributů třídy. Také tato třída obsahuje metody, které inkrementují nebo dekterentují některé atributy třídy. Třída je určena jako ukládání a uchovávání dat se kterými se během programu pracuje. V konstruktoru nainicializuje potřebné atributy. A po té vytvoří proces GenVolicu a předá mu parametr, jako ukazatele na sebe (pomocí ukazatele this). Poté vytváří podobně jako před tím další proces TimerVoleb. Předává mu do kontruktoru také ukazatel na sebe. Tím končí konstruktor této třídy.

\item Třída GenVolicu
\subitem Tato třída reprezentuje proces Generování voličů z konceptuálního modelu na Obr. č. 1. Tato třída se dědí od třídy Event z knihovny SIMlib a obsahuje konstruktor a metordu Behavior(). V konstruktoru se předá ukazatel z objěktu Okrsku ze kterého byl generátor vytvořen do svojeho atributu třídy Okrsku. Dále se taky zde definuje čas, který slouži pro znovu aktivovaní této třídy. Zde také měníme parametr účast volíčů pro celou ČR. V mětodě Behavior() se testuje jestli nenastal konec voleb. Zda-li nenastal, tak vytvoří objekt procesu voliče a předá mu parametr objektu Okrsek, ze kterého byla tato třída vytvořena. Inkrementuje počet generovaných voličů v okrsku a testuje jestli počet vygenerovaných voličů se rovná maximálního počtu voličů v daném okrsku, což je uloženo v atributu Okrsku s názvem pocet\_volicu. Pokud bylo vytvořeno méně voličů, tak se znovu tato třída aktivuje podle součtu času Time a času určeného v konsturuktoru. Ale pokud je vytvořeno stejně voličů jako maximální počet, tak se tato třída znovu neaktivuje, ale nastaví parametr end\_voleb třídy Okrsku na 1 a to pomocí metody konec\_voleb() v objektu Okrsek a tím ukončí dobu konce voleb daného okrsku. 

\item Třída Volic
\subitem Tato třída reprezentuje Proces voliče z konceptuálního modelu na Obr. č. 1. Tato třída se dědí od třídy Process z knihovny SIMlib a obsahuje konstruktor a metordu Behavior(). V konstruktoru se předá ukazatel z atributu \textbf{okrsek} třídy GenVoličů, ve kterém je uložen ukazatel na konkrétní okrsek. Metoda Behavior() určuje chování voliče ve volební komisi. Při vstupu voliče se nejprve zvýší číslo aktuálních voličů v místnoti o 1 pomocí metody v objektu Okrsku increment\_lidi\_v\_mistnosti(). Poté proces voliče pokračuje zabráním si jednoho člena komise, reprezentujícího Store s názvem \textbf{komise} pomocí metody \textbf{get\_komise()} z objektu Okrsek. Po uplynutí dané doby pomocí SIMlib funkce \textbf{Wait()} uvolní zabraného člena komise. Podobně si zabere i jednu z plent. Planta je taky typu Store. Nakonec podobně jako předchozí zařízení zabere i urnu, která je reprezentována zařízením Facility. Proces skončí po odečtení aktuálního čísla voličů pomocí metody \textbf{decrement\_lidi\_v\_mistnosti()}.

\item Třída TimerVoleb
\subitem Tato třída reprezentuje Proces konce chození voličů z konceptuálního modelu na Obr. č. 1. Třída je určena pro ukončení voleb po uplynutí celkového času voleb. Tato třída se dědí od třídy Process z knihovny SIMlib a obsahuje konstruktor a metordu Behavior(). V konstruktoru se předá ukazatel z objěktu Okrsku ze kterého byl timer vytvořen do svojeho atributu třídy Okrsku. V metodě Behavior() se zpustí cyklus, který reprezentuje dobu voleb příchodu voličů způsobem, že v každém cyklu čeká minutu pomocí \textbf{Wait()} a testuje jestli nenastal konec voleb pomocí metody třídy Okrsek \textbf{get\_konec\_voleb()}. Poté spustí cyklus, který čeká na uvolnění místnosti od všech voličů. Testuje se atribut \textbf{lide\_v\_mistnosti} třídy Okrsek. Před ukončením svého konání proces TimerVoleb vytvoří nový proces s názvem \textbf{PocitaniHlasu} a předá mu ukazatel na objekt Okrsku, ze kterého byl vytvořen a aktivuje ho.

\item Třída GenHlasu
\subitem Tato třída reprezentuje Generátor volebních lístků z konceptuálního modelu na Obr. č. 1. Tato třída se dědí od třídy Event z knihovny SIMlib a obsahuje konstruktor a metordu Behavior(). V konstruktoru se předá ukazatel z atributu \textbf{okr} třídy TimerVoleb, ve kterém je uložen ukazatel na konkrétní okrsek. V metodě Behavior() se vytvoří proces \textbf{PocitaniKonkretnihoHlasu} s ukazatelem na Okrsek ulozený v atributu \textbf{okr} třídy a poté se aktivuje. Pomocí metody \textbf{decrement\_poc\_lisktu()} se sníží počet nespočtených volebních lístků. Dále se testuje jestli se vygenerovali všechny lístky pro daný okrsek pomocí metody \textbf{get\_poctu\_zvolenych\_listku()}. Pokud metoda vrátí 0 nastaví se atribut \textbf{spoctene\_hlasy} objektu \textbf{Okrsku}. Pokud metoda vrátí jiné číslo, znovu aktivuje se tato třída v čase Time.

\item Třída PocitaniKonkretnihoHlasu
\subitem Tato třída reprezentuje Proces počítání lístků z konceptuálního modelu na Obr. č. 1. Tato třída se dědí od třídy Process z knihovny SIMlib a obsahuje konstruktor a metordu Behavior(). V konstruktoru se předá ukazatel z atributu \textbf{okr} třídy GenHlasu, ve kterém je uložen ukazatel na konkrétní okrsek. Metoda Behavior() určuje chování počítání lístku členem volební komise. Při začátku počítání lístku se nejprve zvýší číslo aktuálních právě počítaných lístků o 1 pomocí metody v objektu Okrsku \textbf{increment\_prave\_pocitanych\_listku()}. Poté proces počítání lístku pokračuje zabráním si jednoho člena komise, reprezentujícího Store s názvem \textbf{komise} pomocí metody \textbf{get\_komise()} z objektu Okrsek. Po uplynutí dané doby pomocí SIMlib funkce \textbf{Wait()} uvolní zabraného člena komise. Poté vyhodnotí zda-li je lístek platný nebo neplatný. Pokud platný pomocí metody \textbf{increment\_plat\_listku()} v objektu Okrsek se zvýší číslo platných lístků okrsku. Zda-li je lístek neplatný použije se po zvýšení atributu \textbf{poc\_nep\_listku} metoda \textbf{increment\_nep\_listku()} v objetku Okrsek. Proces skončí po odečtení aktuálního čísla voličů pomocí metody \textbf{decrement\_prave\_pocitanych\_listku()}.

\item Třída PocitaniHlasu
\subitem Tato třída reprezentuje Proces počítání hlasů z konceptuálního modelu na Obr. č. 1. Tato třída se dědí od třídy Process z knihovny SIMlib a obsahuje konstruktor a metordu Behavior(). V konstruktoru se předá ukazatel z atributu \textbf{okr} třídy TimerVoleb, ve kterém je uložen ukazatel na konkrétní okrsek. V metodě Behavior() se spustí cyklus, který testuje, zda-li má proběhnout počítání hlasů. Pokud ano, tak vytvoří proces GenHlasu a předá mu ukazatel na objekt Okrsek. Poté spustí cyklus, který končí v případě, že jsou vytvořeny všechny procesy třídy \textbf{PocitaniKonkretnihoHlasu}. Poté se spustí další cyklus, který kontroluje končí v případě, že jsou všechny lístky spočtené. Po nějaké době (pomocí Wait()) vyhodnotí, jestli výsledky jsou správné a nebo ne. Pokud výsledky správné nejsou, tak zavolá metodu \textbf{get\_nul\_prepoctenym\_listkum()}, která nastaví atributy \textbf{poc\_nep\_listku} a \textbf{poc\_plat\_listku} na 0 a atribut \textbf{pocet\_zvolenych\_listku} na původní hodnotu v objektu Okrsek. A cyklus pro vyhodnocení zda-li se mají výsledky počítat se spustí znovu. Pokud jsou výsledky správné, tak si proces třídy PocitaniHlasu zabere zařízení \textbf{Centrum\_republiky} pomocí SIMlib funkce \textbf{Seize}. Po uplynutí času reprezentující posílání výsledků do volebního centra republiky, se zařízení \textbf{Centrum\_republiky} pomocí SIMlib funkce \textbf{Releise} uvolní. Tím končí tento proces.

 

\end{itemize}



\newpage


\section{Podstata simulačných experimentov}
Hlavní cíl, proč byl model vytvořen, bylo zjistit vytíženost Volevního celorepublikového centra a navrhnout změny pro zefektivnění vytíženosti tohoto volebního centra. Ktomu nám pomáhali experimenty. 

\section{Zhrnutie simulačných experimentov a záver}

\subsection{Testovanie}
Testovanie nášho projektu prebiehalo na architektúrach Windows a Linux. Bolo založené na vopred napísaných testoch, ktoré porovnávali jednotlivé výsledky testovanej časti s~referenčnými. Testovanie spočiatku prebiehalo po častiach, tak ako boli postupne implementované jednotlivé časti intepretu.
V~konečnej fáze boli vykonané komplexné testy, ktoré overili funkčnost nášho interpretu jazyka \emph{IFJ12} podľa špecifikácie uvedenej v~zadaní. V~prípade, že bola objavená chyba počas testovania, táto chyba bola ihneď odstránená a interpret bol opäť dôkladne otestovaný.


\subsection{Štatistiky}
\newpage


 
\newpage




\newpage

\section{Referencie}


\bibliographystyle{czechiso}

\bibliography{dokumentace}
\newpage
\end{document}

